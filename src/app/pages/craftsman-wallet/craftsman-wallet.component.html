<div class="wallet-container">
  <!-- LOADING STATE -->
  @if (isLoading()) {
    <div class="loading-wrapper">
      <div class="loading-spinner"></div>
      <p class="loading-text">Loading your wallet...</p>
    </div>
  }

  <!-- ERROR STATE -->
  @else if (errorMessage() && !wallet()) {
    <div class="error-wrapper">
      <div class="error-card">
        <div class="error-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <h2 class="error-title">Failed to Load Wallet</h2>
        <p class="error-message">{{ errorMessage() }}</p>
        <button class="btn btn-retry" (click)="retryLoad()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          Try Again
        </button>
      </div>
    </div>
  }

  <!-- WALLET DATA -->
  @else if (wallet()) {
    <!-- Header with Back Button -->
    <div class="wallet-header">
      <button class="back-button" (click)="goBack()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to Profile
      </button>
      <h1 class="page-title">My Wallet</h1>
    </div>

    <!-- Balance Card -->
    <div class="balance-card">
      <div class="balance-header">
        <div class="balance-icon">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
          </svg>
        </div>
        <div>
          <p class="balance-label">Current Balance</p>
          <h2 class="balance-amount">${{ wallet()?.balance || 0 | number:'1.2-2' }}</h2>
        </div>
      </div>
      <div class="balance-gradient"></div>
    </div>

    <!-- Transactions Section -->
    <div class="transactions-section">
      <div class="section-header">
        <h2 class="section-title">Transaction History</h2>
        <span class="transaction-count">
          {{ getSortedTransactions().length }}
          {{ getSortedTransactions().length === 1 ? 'Transaction' : 'Transactions' }}
        </span>
      </div>

      @if (getSortedTransactions().length === 0) {
        <div class="empty-state">
          <div class="empty-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
          <p class="empty-text">No transactions yet</p>
          <p class="empty-subtext">Your transaction history will appear here</p>
        </div>
      } @else {
        <div class="transactions-list">
          @for (transaction of getSortedTransactions(); track transaction.id) {
            <div class="transaction-card"
                 [class.transaction-positive]="isPositiveTransaction(transaction.transactionType)"
                 [class.transaction-negative]="!isPositiveTransaction(transaction.transactionType)">
              <div class="transaction-icon-wrapper">
                <div class="transaction-icon">
                  @if (getTransactionIcon(transaction.transactionType) === 'arrow-down') {
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                    </svg>
                  } @else if (getTransactionIcon(transaction.transactionType) === 'arrow-up') {
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                    </svg>
                  } @else {
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>
                  }
                </div>
              </div>

              <div class="transaction-details">
                <p class="transaction-type">{{ getTransactionTypeText(transaction.transactionType) }}</p>
                @if (transaction.description) {
                  <p class="transaction-description">{{ transaction.description }}</p>
                }
                <p class="transaction-date">{{ formatDate(transaction.createdAt) }}</p>
              </div>

              <div class="transaction-amount">
                <span [class.amount-positive]="isPositiveTransaction(transaction.transactionType)"
                      [class.amount-negative]="!isPositiveTransaction(transaction.transactionType)">
                  {{ isPositiveTransaction(transaction.transactionType) ? '+' : '-' }}${{ transaction.amount | number:'1.2-2' }}
                </span>
              </div>
            </div>
          }
        </div>
      }
    </div>
  }
</div>
