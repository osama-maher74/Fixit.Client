<div class="offer-review-container">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading offer details...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
        <div class="error-icon">‚ö†Ô∏è</div>
        <h2>Unable to Load Offer</h2>
        <p>{{ error }}</p>
        <button class="btn-back" (click)="goBack()">‚Üê Go Back</button>
    </div>

    <!-- Main Content -->
    <div *ngIf="serviceRequest && !loading" class="offer-content">
        <!-- Header -->
        <div class="offer-header">
            <button class="btn-back-inline" (click)="goBack()">‚Üê Back</button>
            <h1>Offer Review</h1>
            <div class="status-badge" [class.active]="serviceRequest.status === 'Active'">
                {{ serviceRequest.status }}
            </div>
        </div>

        <!-- Service Request Image -->
        <div class="image-section" *ngIf="serviceRequest.serviceRequestImage || serviceRequest.imageUrl">
            <img [src]="getImageUrl()" alt="Service Request" class="service-image">
        </div>

        <!-- Main Details Card -->
        <div class="details-card">
            <h2 class="card-title">Service Details</h2>

            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Service Name</span>
                    <span class="detail-value">{{ serviceRequest.serviceName || 'N/A' }}</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Client Name</span>
                    <span class="detail-value">{{ serviceRequest.clientName || 'N/A' }}</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Craftsman</span>
                    <span class="detail-value">{{ offerCraftsmanName || serviceRequest.craftsManName || 'Not assigned'
                        }}</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Location</span>
                    <span class="detail-value">{{ serviceRequest.location || 'N/A' }}</span>
                </div>
            </div>

            <div class="detail-item full-width">
                <span class="detail-label">Description</span>
                <p class="detail-description">{{ serviceRequest.description || 'No description provided' }}</p>
            </div>
        </div>

        <!-- Dates Card -->
        <div class="details-card">
            <h2 class="card-title">Timeline</h2>

            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Requested At</span>
                    <span class="detail-value">{{ formatDate(serviceRequest.requestAt) }}</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Service Start Time</span>
                    <span class="detail-value">{{ formatDate(serviceRequest.serviceStartTime) }}</span>
                </div>

                <div class="detail-item" *ngIf="serviceRequest.completedAt">
                    <span class="detail-label">Completed At</span>
                    <span class="detail-value">{{ formatDate(serviceRequest.completedAt) }}</span>
                </div>

                <div class="detail-item" *ngIf="serviceRequest.waitingForClientPaymentAt">
                    <span class="detail-label">Waiting for Payment</span>
                    <span class="detail-value">{{ formatDate(serviceRequest.waitingForClientPaymentAt) }}</span>
                </div>
            </div>
        </div>

        <!-- Pricing Card -->
        <div class="pricing-card">
            <h2 class="card-title">Pricing Details</h2>

            <div class="price-row">
                <span class="price-label">Suggested Price</span>
                <span class="price-value suggested">{{ serviceRequest.suggestedPrice?.toFixed(2) || '0.00' }} EGP</span>
            </div>

            <div class="price-divider"></div>

            <div class="price-row highlight">
                <span class="price-label">Craftsman's Offer</span>
                <span class="price-value total">{{ (offerAmount || serviceRequest.totalAmount || 0).toFixed(2) }}
                    EGP</span>
            </div>

            <!-- Show offer description if available -->
            <div *ngIf="offerDescription" class="offer-description"
                style="margin-top: 15px; padding: 15px; background: #F9FAFB; border-radius: 8px;">
                <span class="detail-label" style="display: block; margin-bottom: 8px;">Offer Details</span>
                <p style="margin: 0; color: #374151; line-height: 1.6;">{{ offerDescription }}</p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-accept" (click)="onAccept()">
                <span class="btn-icon">‚úì</span>
                <span class="btn-text">Accept Offer</span>
            </button>
            <button class="btn btn-reject" (click)="onReject()">
                <span class="btn-icon">‚úï</span>
                <span class="btn-text">Reject Offer</span>
            </button>
            <button class="btn btn-new-offer" (click)="onNewOffer()" *ngIf="isCraftsman">
                <span class="btn-icon">üí∞</span>
                <span class="btn-text">New Offer</span>
            </button>
        </div>
    </div>
</div>