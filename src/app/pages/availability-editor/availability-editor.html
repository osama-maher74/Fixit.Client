<div class="availability-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1>{{ 'AVAILABILITY.TITLE' | translate }}</h1>
        <p>{{ 'AVAILABILITY.SUBTITLE' | translate }}</p>
        <button type="button" routerLink="/profile" class="back-button">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            {{ 'AVAILABILITY.BACK_TO_PROFILE' | translate }}
        </button>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
    <div class="loading-state">
        <div class="spinner"></div>
        <p>{{ 'AVAILABILITY.LOADING' | translate }}</p>
    </div>
    }

    <!-- Error Message -->
    @if (errorMessage()) {
    <div class="alert-message error">
        {{ errorMessage() }}
    </div>
    }

    <!-- Success Message -->
    @if (successMessage()) {
    <div class="alert-message success">
        {{ successMessage() }}
    </div>
    }

    <!-- Add Availability Form -->
    <div class="form-card">
        <h2>
            <span>üìÖ</span>
            {{ 'AVAILABILITY.ADD_TITLE' | translate }}
        </h2>

        <form [formGroup]="availabilityForm" (ngSubmit)="onSubmit()">
            <div class="form-grid">
                <!-- Day of Week -->
                <div class="form-group">
                    <label for="dayOfWeek">{{ 'AVAILABILITY.DAY_OF_WEEK' | translate }}</label>
                    <select id="dayOfWeek" formControlName="dayOfWeek">
                        @for (day of daysOfWeek; track day.value) {
                        <option [ngValue]="day.value">{{ day.name }}</option>
                        }
                    </select>
                </div>

                <!-- Start Time -->
                <div class="form-group">
                    <label for="startTime">{{ 'AVAILABILITY.START_TIME' | translate }}</label>
                    <input id="startTime" type="time" formControlName="startTime"
                        [class.error]="hasError('startTime')" />
                    @if (hasError('startTime')) {
                    <span class="error-text">{{ getErrorMessage('startTime') }}</span>
                    }
                </div>

                <!-- End Time -->
                <div class="form-group">
                    <label for="endTime">{{ 'AVAILABILITY.END_TIME' | translate }}</label>
                    <input id="endTime" type="time" formControlName="endTime"
                        [class.error]="hasError('endTime')" />
                    @if (hasError('endTime')) {
                    <span class="error-text">{{ getErrorMessage('endTime') }}</span>
                    }
                </div>

                <!-- Available Checkbox -->
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" formControlName="isAvailable" />
                        <span>{{ 'AVAILABILITY.AVAILABLE' | translate }}</span>
                    </label>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" [disabled]="isSaving()" class="submit-button">
                @if (isSaving()) {
                <span>{{ 'AVAILABILITY.ADDING' | translate }}</span>
                } @else {
                <span>{{ 'AVAILABILITY.ADD_BUTTON' | translate }}</span>
                }
            </button>
        </form>
    </div>

    <!-- Weekly Schedule Grid -->
    <div class="schedule-grid">
        <h2>
            <span>üìÜ</span>
            {{ 'AVAILABILITY.WEEKLY_SCHEDULE' | translate }}
        </h2>

        <div class="days-container">
            @for (day of daysOfWeek; track day.value) {
            <div class="day-card">
                <!-- Day Header -->
                <div class="day-header">
                    <h3>{{ day.name }}</h3>
                </div>

                <!-- Day Content -->
                <div class="day-content">
                    @if (getAvailabilityByDay(day.value).length === 0) {
                    <p class="empty-state">
                        {{ 'AVAILABILITY.NO_AVAILABILITY' | translate }}
                    </p>
                    } @else {
                    <div class="slots-container">
                        @for (av of getAvailabilityByDay(day.value); track av.id) {
                        <div class="slot-item">
                            <!-- Time Info -->
                            <div class="slot-info">
                                <span class="icon">üïê</span>
                                <span class="time-text">
                                    {{ formatTime(av.startTimeFormatted || av.startTime) }} - {{ formatTime(av.endTimeFormatted || av.endTime) }}
                                </span>
                                <span class="status-badge" [class.available]="av.isAvailable" [class.unavailable]="!av.isAvailable">
                                    {{ av.isAvailable ? ('AVAILABILITY.AVAILABLE' | translate) : ('AVAILABILITY.UNAVAILABLE' | translate) }}
                                </span>
                            </div>

                            <!-- Delete Button -->
                            <button type="button" (click)="deleteAvailability(av.id, day.name)" title="Delete" class="delete-button">
                                √ó
                            </button>
                        </div>
                        }
                    </div>
                    }
                </div>
            </div>
            }
        </div>
    </div>
</div>
