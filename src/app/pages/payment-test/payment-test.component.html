<div class="payment-container">
  <div class="payment-card">
    <!-- Header -->
    <div class="payment-header">
      <h1 class="payment-title">{{ 'PAYMENT.TITLE' | translate }}</h1>
      <p class="payment-subtitle">{{ 'PAYMENT.SUBTITLE' | translate }}</p>
    </div>

    <!-- Payment Completed Success View -->
    @if (paymentCompleted()) {
      <div class="success-container">
        <div class="success-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>

        <h2 class="success-title">{{ 'PAYMENT.SUCCESS_TITLE' | translate }}</h2>
        <p class="success-message">{{ successMessage() }}</p>

        <div class="payment-details">
          <div class="detail-row">
            <span class="detail-label">{{ 'PAYMENT.AMOUNT' | translate }}:</span>
            <span class="detail-value">${{ formatAmount(completedPaymentAmount() || 0) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">{{ 'PAYMENT.TRANSACTION_ID' | translate }}:</span>
            <span class="detail-value transaction-id">{{ completedPaymentId() }}</span>
          </div>
        </div>

        <div class="success-actions">
          <button
            type="button"
            class="btn btn-primary"
            (click)="resetPayment()"
          >
            {{ 'PAYMENT.MAKE_ANOTHER_PAYMENT' | translate }}
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            (click)="goHome()"
          >
            {{ 'PAYMENT.BACK_TO_HOME' | translate }}
          </button>
        </div>
      </div>
    }

    <!-- Payment Form -->
    @else {
      <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()" class="payment-form">
        <!-- Loading State -->
        @if (isLoadingStripe()) {
          <div class="loading-container">
            <div class="spinner"></div>
            <p>{{ 'PAYMENT.LOADING_STRIPE' | translate }}</p>
          </div>
        }

        <!-- Error Alert -->
        @if (errorMessage()) {
          <div class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
            </svg>
            <span>{{ errorMessage() }}</span>
          </div>
        }

        <!-- Service Request ID Field -->
        <div class="form-group">
          <label for="serviceRequestId" class="form-label">
            {{ 'PAYMENT.SERVICE_REQUEST_ID_LABEL' | translate }} *
          </label>
          <input
            type="number"
            id="serviceRequestId"
            formControlName="serviceRequestId"
            class="form-control"
            [class.error]="serviceRequestId?.invalid && serviceRequestId?.touched"
            placeholder="5"
            min="1"
          />

          <!-- Service Request ID Validation Errors -->
          @if (serviceRequestId?.invalid && serviceRequestId?.touched) {
            <div class="error-message">
              @if (serviceRequestId?.errors?.['required']) {
                <span>{{ 'PAYMENT.SERVICE_REQUEST_ID_REQUIRED' | translate }}</span>
              }
              @if (serviceRequestId?.errors?.['min']) {
                <span>{{ 'PAYMENT.SERVICE_REQUEST_ID_MIN' | translate }}</span>
              }
              @if (serviceRequestId?.errors?.['pattern']) {
                <span>{{ 'PAYMENT.SERVICE_REQUEST_ID_INVALID' | translate }}</span>
              }
            </div>
          }

          <!-- Helper text -->
          <p class="form-helper-text">{{ 'PAYMENT.SERVICE_REQUEST_ID_HELPER' | translate }}</p>
        </div>

        <!-- Card Details Section -->
        <div class="card-section">
          <h3 class="section-title">{{ 'PAYMENT.CARD_DETAILS_LABEL' | translate }}</h3>

          <!-- Card Number -->
          <div class="form-group">
            <label class="form-label">
              {{ 'PAYMENT.CARD_NUMBER_LABEL' | translate }} *
            </label>
            <div class="stripe-element-container">
              <div id="card-number-element" class="stripe-element"></div>
            </div>
            @if (stripeService.cardNumberError()) {
              <div class="error-message">
                <span>{{ stripeService.cardNumberError() }}</span>
              </div>
            }
          </div>

          <!-- Expiry and CVC Row -->
          <div class="card-row">
            <!-- Card Expiry -->
            <div class="form-group form-group-half">
              <label class="form-label">
                {{ 'PAYMENT.CARD_EXPIRY_LABEL' | translate }} *
              </label>
              <div class="stripe-element-container">
                <div id="card-expiry-element" class="stripe-element"></div>
              </div>
              @if (stripeService.cardExpiryError()) {
                <div class="error-message">
                  <span>{{ stripeService.cardExpiryError() }}</span>
                </div>
              }
            </div>

            <!-- Card CVC -->
            <div class="form-group form-group-half">
              <label class="form-label">
                {{ 'PAYMENT.CARD_CVC_LABEL' | translate }} *
              </label>
              <div class="stripe-element-container">
                <div id="card-cvc-element" class="stripe-element"></div>
              </div>
              @if (stripeService.cardCvcError()) {
                <div class="error-message">
                  <span>{{ stripeService.cardCvcError() }}</span>
                </div>
              }
            </div>
          </div>

          <!-- Card Icons -->
          <div class="card-brands">
            <span class="card-brand-text">{{ 'PAYMENT.ACCEPTED_CARDS' | translate }}:</span>
            <div class="brand-icons">
              <svg class="brand-icon" viewBox="0 0 24 24" fill="currentColor">
                <title>Visa</title>
                <path d="M9.112 8.262L5.97 15.758h-2.09L2.49 9.775c-.11-.434-.206-.594-.54-.777C1.416 8.65.22 8.367 0 8.27l.05-.008h3.602c.47 0 .887.314.992.855l.906 4.827 2.24-5.682h2.322zm9.23 0l-1.454 7.496h-2.205l1.454-7.496h2.205zm-4.112 0c.906 0 2.385.314 2.385 1.634 0 .906-.68 1.474-1.634 1.78-.953.307-1.274.524-1.274.838 0 .47.524.732 1.112.732.732 0 1.416-.157 1.888-.367l.262 1.23c-.524.21-1.258.42-2.195.42-2.3 0-3.155-1.23-3.155-2.405 0-.888.576-1.635 1.74-2.195.733-.367 1.1-.62 1.1-.992 0-.42-.314-.73-1.05-.73-.888 0-1.73.262-2.195.524l-.262-1.23c.576-.21 1.415-.42 2.478-.42zm6.293 0l1.415 7.496h-2.09l-.21-.993h-2.71l-.42.993h-2.3l3.155-6.853c.21-.472.576-.643 1.05-.643h2.11zm-.524 2.09l-.944 2.79h1.888l-.944-2.79z"/>
              </svg>
              <svg class="brand-icon" viewBox="0 0 24 24" fill="currentColor">
                <title>Mastercard</title>
                <path d="M11.343 18.031c.058.049.12.098.181.146-1.177.783-2.59 1.238-4.107 1.238C3.32 19.416 0 16.096 0 12c0-4.095 3.32-7.416 7.416-7.416 1.518 0 2.931.456 4.105 1.238-.06.051-.12.098-.165.15C9.6 7.489 8.595 9.688 8.595 12c0 2.311 1.001 4.51 2.748 6.031zm5.241-13.447c-1.52 0-2.931.456-4.105 1.238.06.051.12.098.165.15C14.4 7.489 15.405 9.688 15.405 12c0 2.31-1.001 4.507-2.748 6.031-.058.049-.12.098-.181.146 1.177.783 2.588 1.238 4.107 1.238C20.68 19.416 24 16.096 24 12c0-4.094-3.32-7.416-7.416-7.416z"/>
              </svg>
              <svg class="brand-icon" viewBox="0 0 24 24" fill="currentColor">
                <title>American Express</title>
                <path d="M0 7.334v9.332h24V7.334H0zm8.47 6.408H5.985v-.844h2.173v-1.25H5.985v-.844h2.485v-1.25H4.61v5.532h3.86v-1.344zm4.18 1.344l-1.326-2.203-1.329 2.203H8.432l2.203-2.766L8.432 9.35h1.563l1.329 2.203 1.326-2.203h1.563l-2.203 2.766 2.203 2.766h-1.563zm7.076-1.344h-2.485v-.844h2.173v-1.25h-2.173v-.844h2.485v-1.25h-3.86v5.532h3.86v-1.344z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Security Notice -->
        <div class="security-notice">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
          </svg>
          <span>{{ 'PAYMENT.SECURITY_NOTICE' | translate }}</span>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="btn btn-primary submit-btn"
          [disabled]="isProcessing() || paymentForm.invalid"
        >
          @if (isProcessing()) {
            <span class="spinner"></span>
            <span>{{ 'PAYMENT.PROCESSING' | translate }}</span>
          } @else {
            <span>{{ 'PAYMENT.PAY_NOW' | translate }}</span>
          }
        </button>

        <!-- Cancel Button -->
        <button
          type="button"
          class="btn btn-secondary"
          (click)="goHome()"
          [disabled]="isProcessing()"
        >
          {{ 'PAYMENT.CANCEL' | translate }}
        </button>
      </form>
    }

    <!-- Powered by Stripe -->
    <div class="stripe-badge">
      <span>{{ 'PAYMENT.POWERED_BY' | translate }}</span>
      <svg viewBox="0 0 60 25" xmlns="http://www.w3.org/2000/svg">
        <path fill="var(--primary-gold)" d="M59.64 14.28h-8.06c.19 1.93 1.6 2.55 3.2 2.55 1.64 0 2.96-.37 4.05-.95v3.32a8.33 8.33 0 0 1-4.56 1.1c-4.01 0-6.83-2.5-6.83-7.48 0-4.19 2.39-7.52 6.3-7.52 3.92 0 5.96 3.28 5.96 7.5 0 .4-.04 1.26-.06 1.48zm-5.92-5.62c-1.03 0-2.17.73-2.17 2.58h4.25c0-1.85-1.07-2.58-2.08-2.58zM40.95 20.3c-1.44 0-2.32-.6-2.9-1.04l-.02 4.63-4.12.87V5.57h3.76l.08 1.02a4.7 4.7 0 0 1 3.23-1.29c2.9 0 5.62 2.6 5.62 7.4 0 5.23-2.7 7.6-5.65 7.6zM40 8.95c-.95 0-1.54.34-1.97.81l.02 6.12c.4.44.98.78 1.95.78 1.52 0 2.54-1.65 2.54-3.87 0-2.15-1.04-3.84-2.54-3.84zM28.24 5.57h4.13v14.44h-4.13V5.57zm0-4.7L32.37 0v3.36l-4.13.88V.88zm-4.32 9.35v9.79H19.8V5.57h3.7l.12 1.22c1-1.77 3.07-1.41 3.62-1.22v3.79c-.52-.17-2.29-.43-3.32.86zm-8.55 4.72c0 2.43 2.6 1.68 3.12 1.46v3.36c-.55.3-1.54.54-2.89.54a4.15 4.15 0 0 1-4.27-4.24l.01-13.17 4.02-.86v3.54h3.14V9.1h-3.13v5.85zm-4.91.7c0 2.97-2.31 4.66-5.73 4.66a11.2 11.2 0 0 1-4.46-.93v-3.93c1.38.75 3.1 1.31 4.46 1.31.92 0 1.53-.24 1.53-1C6.26 13.77 0 14.51 0 9.95 0 7.04 2.28 5.3 5.62 5.3c1.36 0 2.72.2 4.09.75v3.88a9.23 9.23 0 0 0-4.1-1.06c-.86 0-1.44.25-1.44.9 0 1.85 6.29.97 6.29 5.88z"/>
      </svg>
    </div>
  </div>
</div>
